<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Stegano</title>
  <meta name="generator" content="Geany 1.33" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

  {{{cfg.head}}}

  {{{cfg.theme}}}

  {{{cfg.styles.index}}}

<style>
  p {
    width: 50%;
    padding-left: .7em;
    border-radius: 10px;
  }
</style>

</head>
<script>

// Modified:
//  https://stackoverflow.com/questions/1349404/generate-random-string-characters-in-javascript
function makeid(length, upper = true, lower = true, digit = true) {
  var result           = '';
  var characters       = '';
  if (upper) characters += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  if (lower) characters += 'abcdefghijklmnopqrstuvwxyz';
  if (digit) characters += '0123456789';
  var charactersLength = characters.length;
  for ( var i = 0; i < length; i++ ) {
    result += characters.charAt(Math.floor(Math.random() * charactersLength));
  }
  return result;
}

submitGenKeys = () => {
  const form = document.getElementById('genKeysForm');
  form.submit();
}

onload = () => {
  document.getElementById('keyname').value = makeid(10);
  document.getElementById('keyemail').value =
    makeid(10, false) + '@' + makeid(10, false) + '.net';
}
</script>

<body>
  {{{cfg.logo}}}
  {{{cfg.heading}}}

  <input type="button" value="Messages" onclick="window.location.href='/imagesdir'">

  <h4>Lockboxes</h4>
  <p><img style="height: 5em;width: auto;float:right; margin-left:1em;" src="/assets/chest-2884250_640.png">
  A lockbox contains a set of keys (a keyring), as well as the images in which that
  keyring was used to hide messages. You can create as many lockboxes as you want allowing
  differing groups of recipients.
  <br>To open a lockbox requires a phrase which
  is magically bound to the box. The phase can not be changed and the lockbox
  can not be opened without it. Both the sender and recipient(s) need to know
  the phrase to open the lockbox.
  <br>Note that even if one knows the lockbox phrase - each image in the box
  still requires proper keys to unscramble the messages contained within.</p>

  <h4>Lockbox phrase</h4>
  <p><img style="height: 3em;width: auto;float:left;border-radius: 10px;margin-right:1em;" src="/assets/chest-2536477_640.png">
  Each lockbox has a name which is added to scrambled images filenames.
  This helps recipients identify images containing messages. The first time
  an image in a lockbox is unscrambled the system will ask for the lockbox phrase.
  If is successsful then the phrase is encrypted and stored for future messages,
  <br>Each Lockbox has a special ability to send it's phrase to others without
  (obviouly) requiring it to be unlocked by the recipients. Only the creator
  can send it, and only to people currently on it's keyring.</p>

  <h4>Keyrings</h4>
  <p><img style="height: 3em;width: auto;float:left;border-radius: 10px;margin-right:1em;" src="/assets/key-1242056_640.jpg"></p>
  <p>When an image contains someones public key you will be given the opportunity
  to place the key in any lockboxes that you wish. Thus the key will be added
  to each selected lockbox's keyring.
  <br>When you put a message (with image) in a lockbox, the message is scrambled,
  signed, and embedded into the image such that the resulting image can be sent
  safely; knowing that only the people on the keyring can unscramble it and only
  if they have your public key, and firstly know the phrase needed to unlock the box.</p>

  <h3>Make your lockbox</h3>
  <p>So let's begin with a few questions needed to make you lockbox...</p>
  <div class="left-side box">
    <form name="lockboxForm" id="lockboxForm" action="/genbox" method="post" encType="multipart/form-data">
    Name of lockbox so friends know it is yours. Images will
    have this name included in their filename - so only letters, numbers, spaces,
    and underbars are allowed :(<br>
    <input type="text" id="keyname" name="keyname" form="genKeysForm" value="" />
   <br>Optional short description, quote, saying shown with your public key<br>
    <input type="text" name="keycomment" form="lockboxForm" value="" />
  <br><img style="height: 5em;width: auto;float:right; margin-left:1em;" src="/assets/chest-2884250_640.png">
    Enter secret phrase that opens the lockbox containing your private key. Any characters can
    be used but highly recommend just words of a phrase you will remember. The phrase
    you enter will not be known or shown again, so might wanna have a copy in a safe place.<br>
    <input type="text" name="keypassphrase" form="lockboxForm" value="{{{cfg.key.passphrase}}}" />
    <br>Excellent, press this button to create your keys.<br>
    <button onclick="submitLockbox();">Create keys and lockbox</button>
    </form>
  </div>
  <div class="right-side"></div>

  <div style="clear: both;"></div>
{{#cfg.inlineHelp}}
  <p>Not real long, but takes a bit of time to generate the keys.</p>
{{/cfg.inlineHelp}}
  <footer>{{{cfg.footer}}}</footer>
</body>

</html>
